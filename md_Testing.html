<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>WindowsDevicePortalWrapper: Running Tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WindowsDevicePortalWrapper
   &#160;<span id="projectnumber">0.9.0.0</span>
   </div>
   <div id="projectbrief">A client library that wraps the Windows Device Portal REST APIs.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Running Tests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>/// Summary description for DemoTest /// </p>
<p>There are two types of tests for excercising the wrapper library.</p>
<p>First, unit tests built against mock responses should be run before every Pull Request. Use Run All via the Test Explorer in Visual Studio prior to submitting any Pull Requests. You can also configure Visual Studio to automatically run the tests after each build of the solution via Test Settings in the Test menu. <br />
</p>
<div class="image">
<img src="https://cloud.githubusercontent.com/assets/19478513/17338380/16900018-589c-11e6-87a6-8091d62ce399.png"  alt="runalltests"/>
</div>
<p>Second, manual or semi-automated tests can also be run on a per-device basis via the device specific apps. See the following for information on running these apps:</p>
<p>For Xbox One: https://github.com/Microsoft/WindowsDevicePortalWrapper/blob/master/XboxWDPDriver.md "Using the XboxWdpDriver to test wrappers against a real Xbox One"</p>
<h1>Writing Tests</h1>
<p><a class="el" href="namespace_windows.html">Windows</a> Device Portal Wrapper (WDPW) tests are run against mock data so that a windows device is not required to run the tests.</p>
<ol type="1">
<li>Create a Unit Test class in the Unit Test Project <div class="image">
<img src="https://cloud.githubusercontent.com/assets/1520739/17310088/225af006-57f7-11e6-834c-7735b7270d85.png"  alt="addunittest"/>
</div>
</li>
<li>Have the test class inherit from the BaseTests class which will automatically establish your mock connection (the constructor and TestContext can be removed)</li>
</ol>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c#}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; ///</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  [TestClass]</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  public class DemoTest : BaseTests</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  }</div></div><!-- fragment --><p>a. If you are writing a device specific version test then override the PlatformType, the FriendlyOperatingSystemVersion used to specify where mock files are stored/named, and the OperatingSystemVersion to be used when validating the OS’s actual version number.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c#}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; /// &lt;summary&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;/// Gets the Platform type these tests are targeting.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;/// &lt;/summary&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;protected override DevicePortalPlatforms PlatformType</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;{</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  get { return DevicePortalPlatforms.XboxOne;}</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;}</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;/// &lt;summary&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;/// Gets the friendly OS Version these tests are targeting.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;/// &lt;/summary&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;protected override string FriendlyOperatingSystemVersion</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;{</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  get { return &quot;rs1_xbox_rel_1608&quot;;}</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;}</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;/// &lt;summary&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;/// Gets the OS Version these tests are targeting.</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;/// &lt;/summary&gt;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;protected override string OperatingSystemVersion</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;{</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  get { return &quot;14385_1002_amd64fre_rs1_xbox_rel_1608_160709_1700&quot;;}</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;}</div></div><!-- fragment --><ol type="1">
<li>Define void methods with no parameters tagged with “testMethod” for each test case you want to run</li>
</ol>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c#}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  [TestMethod]</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  public void TestMethod1()</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  {</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    //</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    // TODO: Add test logic here</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    //</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  }</div></div><!-- fragment --><ol type="1">
<li><p class="startli">Each test should start with a call to TestHelpers.MockHttpResponder.AddMockResponse to prepare a mock response for a specified endpoint in one of three ways:</p>
<p class="startli">a. Default mock</p>
<p class="startli">Use mock data from the MockData\ &lt;endpoint&gt;_Default.dat file. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c#}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  TestHelpers.MockHttpResponder.AddMockResponse(DevicePortal.MachineNameApi, HttpMethods.Get);</div></div><!-- fragment --><p> b. Version specific mock</p>
<p class="startli">Use mock data from the MockData\ &lt;platform&gt;\ &lt;friendly OS version&gt;\ &lt;endpoint&gt;_&lt;platform&gt;_&lt;friendly OS version&gt;.dat file </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c#}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  TestHelpers.MockHttpResponder.AddMockResponse(DevicePortal.KnownFoldersApi, this.PlatformType, this.FriendlyOperatingSystemVersion, HttpMethods.Get);</div></div><!-- fragment --><p> c. Provided response</p>
<p class="startli">Use a response object as a mock. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c#}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  TestHelpers.MockHttpResponder.AddMockResponse(DevicePortal.GetFilesApi, response, HttpMethods.Get);</div></div><!-- fragment --></li>
<li>Have the test methods use TestHelpers.Portal to call DevicePortal methods and then Assert methods to validate results</li>
</ol>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c#}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  Task&lt;string&gt; getNameTask = TestHelpers.Portal.GetDeviceName();</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  getNameTask.Wait();</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  Assert.IsNotNull(TestHelpers.Portal.OperatingSystemVersion);</div></div><!-- fragment --><ol type="1">
<li><p class="startli">After building the test right click on it in the test explorer and select “Debug Selected Tests” to be able to hit selected break points as it runs.</p>
<div class="image">
<img src="https://cloud.githubusercontent.com/assets/1520739/17310093/27a33636-57f7-11e6-8cab-45620c167dcf.png"  alt="debugselectedtests"/>
</div>
</li>
</ol>
<h1>Collecting Data for Tests</h1>
<h2>Using MockDataGenerator.exe to Generate Mock Data</h2>
<p>MockDataGenerator.exe, from the <a class="el" href="namespace_mock_data_generator.html">MockDataGenerator</a> project, is used to target a WDP instance to create mock data.</p>
<h3><a class="el" href="namespace_mock_data_generator.html">MockDataGenerator</a> Parameters</h3>
<table class="doxtable">
<tr>
<th>Parameter </th><th>Purpose  </th></tr>
<tr>
<td>/Address </td><td>URL for device (eg. <a href="https://10.0.0.1:11443">https://10.0.0.1:11443</a>) </td></tr>
<tr>
<td>/User </td><td>WDP username </td></tr>
<tr>
<td>/Pwd </td><td>WDP password </td></tr>
<tr>
<td>/Endpoint </td><td>API to call (default is all endoints in program.cs) </td></tr>
<tr>
<td>/Method </td><td>HTTP method to use (default is GET) </td></tr>
<tr>
<td>/Directory </td><td>Directory to save mock data file(s) (default is .) </td></tr>
<tr>
<td>/requestBody </td><td>File to use for the request body. Only applicable when /Endpoint is present. </td></tr>
<tr>
<td>/requestBodyMultiPartFile </td><td>Normally the requestBody file is considered JSON and provided as is. Specify this parameter to include it as a multipart file instead. </td></tr>
</table>
<h3><a class="el" href="namespace_mock_data_generator.html">MockDataGenerator</a> File Name Format</h3>
<p>All mock data is saved as files in the &lt;endpoint&gt;_&lt;platform&gt;_&lt;friendly OS version&gt;.dat format, such as api_os_devicefamily_XboxOne_rs1_xbox_rel_1608.dat.</p>
<p>All file names are pre-pended with the HTTP method except for GET (as it is the default). Hence the file name for calling the <a class="el" href="namespace_system.html">System</a> Performance API with GET is api_resourcemanager_systemperf_XboxOne_rs1_xbox_rel_1608.dat but calling the WebSocket is WebSocket_api_resourcemanager_systemperf_XboxOne_rs1_xbox_rel_1608.dat.</p>
<h3><a class="el" href="namespace_mock_data_generator.html">MockDataGenerator</a> Examples</h3>
<p>All examples connect to 10.0.0.1:11443 with username TestUser and password SuperSecret.</p><ul>
<li>Generate all mocks specified in the Program.cs Endpoints array and store them in .</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MockDataGenerator.exe  /ip: 10.0.0.1:11443 /user:TestUser /pwd:SuperSecret</div></div><!-- fragment --><ul>
<li>Generate mock for the device family API and store it in .</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MockDataGenerator.exe  /ip: 10.0.0.1:11443 /user:TestUser /pwd:SuperSecret /endpoint:api/os/devicefamily</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MockDataGenerator.exe  /ip: 10.0.0.1:11443 /user:TestUser /pwd:SuperSecret /endpoint:api/os/devicefamily /method:Get</div></div><!-- fragment --><ul>
<li>Generate mock for the <a class="el" href="namespace_system.html">System</a> Performance API web socket connection and store it in .</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MockDataGenerator.exe  /ip: 10.0.0.1:11443/user:TestUser /pwd:SuperSecret /endpoint:api/resourcemanager/systemperf /method:WebSocket</div></div><!-- fragment --><ul>
<li><p class="startli">Generate mock for a POST call to upload a file, specifying the file to use for the request body.</p>
<p class="startli">```shell MockDataGenerator.exe /ip: 10.0.0.1:11443/user:TestUser /pwd:SuperSecret /endpoint:api/filesystem/apps/file?knownfolderid=LocalAppData&amp;packagefullname=MyTestPackage_Fullname /method:Post /requestBody:myfile.txt /requestBodyMultiPartFile ```</p>
</li>
</ul>
<h2>Adding Mock Data to the Solution</h2>
<ol type="1">
<li>Mock data should be added to the UnitTestProject in the MockData directory.<ul>
<li><p class="startli">Default mock data should be added to the MockData directory.</p>
<div class="image">
<img src="https://cloud.githubusercontent.com/assets/1520739/17312218/ff62b160-5805-11e6-92f9-0934fc50b961.png"  alt="defaultmocks"/>
</div>
</li>
</ul>
</li>
</ol>
<pre class="fragment">* Device-version mock data should be added to the MockData&lt;Device\&gt;\ \&lt;Friendly OS Version\&gt; directory with the Friendly OS Version parsed from the mock data’s file name.

  ![platformspecificmocks](https://cloud.githubusercontent.com/assets/1520739/17312269/5248edf4-5806-11e6-833e-cb2445ffc0f1.png)
</pre><ol type="1">
<li><p class="startli">In the properties view the mock data files should have their “Copy to Output Directory” property marked as “Copy if newer.” If this is not done then the tests will be unable to find the files.</p>
<div class="image">
<img src="https://cloud.githubusercontent.com/assets/1520739/17312271/55911450-5806-11e6-9616-eaf7de842121.png"  alt="copytooutputdirectory"/>
</div>
 </li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
